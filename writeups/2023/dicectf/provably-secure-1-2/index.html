<!doctype html><html lang=en-us><head><title>Provably Secure 1 and 2 | flocto</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.112.6"><link rel=canonical href=/writeups/2023/dicectf/provably-secure-1-2/><link href=/sass/main.min.39ece682d01021effadbf2d7ce0f71f0aec2ff50bfab20c565a139b86b029979.css rel=stylesheet></head><body><div class=flexWrapper><header class=headerWrapper><div class=header><div><a href=/><span class=terminal>fl@cto ~ $</span></a></div><nav class=headerLinks><ul><li><a href=/about title>~/about</a></li><li><a href=/projects title>~/projects</a></li><li><a href=/writeups title>~/writeups</a></li><li><a href=/blog title>~/blog</a></li><li><a href=/ style=align-items:center;justify-content:center><img style=width:30px;height:30px;border-radius:15px;vertical-align:text-bottom src=/profile.png alt=Home></a></li></ul></nav></div></header><div class=content><main class=main><div class=postWrapper><h1>Provably Secure 1 and 2</h1><ul class=tagList><li class=tagItem><a class=tagLink href=/tags/crypto/>crypto</a></li><li class=tagItem><a class=tagLink href=/tags/dicectf/>dicectf</a></li><li class=tagItem><a class=tagLink href=/tags/2023/>2023</a></li></ul><div><p>Wanted to try out something different, so I decided to use Motion Canvas to try and make a video writeup for the 2 easy crypto challs&mldr;</p><p>Only to end up spending 2 weeks to make a 5 minute video with no audio lol.</p><p>Here&rsquo;s a short text writeup for the both of them:</p><h2 id=provably-secure-1>Provably Secure 1</h2><p>Server doesn&rsquo;t properly handle checking already encrypted ciphertext, so we can literally just treat it like an encryption/decryption oracle.</p><p>We have to guess <code>m_bit</code> 128 times depending on which message is encrypted, so just using two unique messages is fine.
Shortcut: use <code>0</code> and <code>1</code> so we can just cast to int and directly send it to the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tqdm <span style=color:#f92672>import</span> tqdm
</span></span><span style=display:flex><span><span style=color:#75715e># nc mc.ax 31493</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;mc.ax&#39;</span>, <span style=color:#ae81ff>31493</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> tqdm(range(<span style=color:#ae81ff>128</span>)):
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m0 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m1 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>31</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ct <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;ct (512 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(ct)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> int(m) <span style=color:#75715e># 0 or 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m_bit guess:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(str(m)<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h2 id=provably-secure-2>Provably Secure 2</h2><h4 id=actual-exploitation-of-encryption-scheme-but-same-setup-just-with-fatal-bug-fixed>Actual exploitation of encryption scheme, but same setup, just with fatal bug fixed.</h4><p>There is two keys, so we can split scheme into two seperate functions that occur on the same pair.
Treat encryption and decryption as black box functions: (<code>r</code> is random bytes, <code>m_b</code> is chosen message)
$$
\begin{align}
E(m_1, m_2) &=& E_1(r), E_2(r \oplus m_b) \newline
D(c_1, c_2) &=& D_1(c_1) \oplus D_2(c_2)
\end{align}
$$</p><p>$$
\begin{align}
D_1(E_1(x)) = x \newline
D_2(E_2(x)) = x
\end{align}
$$
We have free control over <code>m_1</code>, <code>m_2</code> for encryption, and <code>c_1</code>, <code>c_2</code> for decryption.</p><p>However, we don&rsquo;t know <code>r</code>.</p><p>But consider the following construction where we swap ciphertext pairs:
(apologies for spaghetti but hopefully you get the idea)
$$
\begin{align}
E_1(r_1), E_2(r_1 \oplus m_{b1}) = E(m_1, m_2) \newline
E_1(r_2), E_2(r_2 \oplus m_{b2}) = E(m_1, m_2)
\end{align}
$$</p><p>$$
D(E_1(r_1), E_2(r_2 \oplus m_{b2}))
= D_1(E_1(r_1)) \oplus D_2(E_2(r_2 \oplus m_{b2}))
= r_1 \oplus (r_2 \oplus m_{b2})
= r_1 \oplus r_2 \oplus m_{b2}
$$</p><p>$$
D(E_1(r_2), E_2(r_1 \oplus m_{b1}))
= D_1(E_1(r_2)) \oplus D_2(E_2(r_1 \oplus m_{b1}))
= r_2 \oplus (r_1 \oplus m_{b1})
= r_1 \oplus r_2 \oplus m_{b1}
$$</p><p>Notice that if <code>m_b1</code> and <code>m_b2</code> are the same, then <code>r_1 \oplus r_2 \oplus m_b1</code> is the same as <code>r_1 \oplus r_2 \oplus m_b2</code>.</p><p>So all we have to do is vary one message, and recover <code>m_bit</code> based on whether the swapped decryption changes or not.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tqdm <span style=color:#f92672>import</span> tqdm
</span></span><span style=display:flex><span><span style=color:#75715e># nc mc.ax 31497</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;mc.ax&#39;</span>, <span style=color:#ae81ff>31497</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> tqdm(range(<span style=color:#ae81ff>128</span>)):
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m0 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m1 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>31</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ct1 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m0 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>32</span> )
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m1 (16 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>31</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ct2 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dt1 <span style=color:#f92672>=</span> ct1[:<span style=color:#ae81ff>512</span>] <span style=color:#f92672>+</span> ct2[<span style=color:#ae81ff>512</span>:]
</span></span><span style=display:flex><span>    dt2 <span style=color:#f92672>=</span> ct2[:<span style=color:#ae81ff>512</span>] <span style=color:#f92672>+</span> ct1[<span style=color:#ae81ff>512</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;ct (512 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(dt1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m1 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;ct (512 byte hexstring):&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(dt2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m2 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> int(m1 <span style=color:#f92672>!=</span> m2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Action:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;m_bit guess:&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(str(m)<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h2 id=video>Video</h2><p>Here&rsquo;s the <a href="https://www.youtube.com/watch?v=vAcX--GornA&amp;ab_channel=flocto">video</a> if you want to watch it, but its basically the same as above with cooler visuals.</p></div></div></main></div><script>function handle_open(e){e.target.classList.toggle("open"),e.target.classList.contains("open")?e.target.textContent="Click to collapse "+e.target.textContent.split(" ").slice(3).join(" "):e.target.textContent="Click to expand "+e.target.textContent.split(" ").slice(3).join(" ")}let code_divs=document.querySelectorAll("div.highlight"),to_remove=[];for(let e of code_divs){let t="",n=e.previousElementSibling;n.tagName=="P"&&(n=n.textContent,n.startsWith("filename")&&(t=n.split("=")[1].trim(),to_remove.push(e.previousElementSibling)));let s=e.querySelector("pre code"),o=s.textContent.split(`
`).length;if(t!==""||o>10){console.log(e);let n=document.createElement("details"),i=document.createElement("summary"),o=document.createElement("span");o.textContent="Click to expand",t!==""&&(o.textContent+=" "+t,n.setAttribute("id",t)),o.classList.add("code-summary-inner"),o.addEventListener("click",handle_open),i.appendChild(o),i.classList.add("code-summary"),s.classList.add("code-inner"),e.parentNode.insertBefore(n,e),n.appendChild(i),n.appendChild(e),n.classList.add("code-wrapper")}}for(let e of to_remove)e.remove()</script><footer class=footer>© 2023 flocto, Built with
<a href=https://gohugo.io class=footerLink>Hugo</a> and (an edited)
<a href=https://github.com/LordMathis/hugo-theme-nightfall class=footerLink>Nightfall</a> theme</footer><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></div></body></html>