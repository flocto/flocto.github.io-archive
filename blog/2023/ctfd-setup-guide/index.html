<!doctype html><html lang=en-us><head><title>CTFd Setup Guide | flocto</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.112.6"><link rel=canonical href=/blog/2023/ctfd-setup-guide/><link href=/sass/main.min.39ece682d01021effadbf2d7ce0f71f0aec2ff50bfab20c565a139b86b029979.css rel=stylesheet></head><body><div class=flexWrapper><header class=headerWrapper><div class=header><div><a href=/><span class=terminal>fl@cto ~ $</span></a></div><nav class=headerLinks><ul><li><a href=/about title>~/about</a></li><li><a href=/projects title>~/projects</a></li><li><a href=/writeups title>~/writeups</a></li><li><a href=/blog title>~/blog</a></li><li><a href=/ style=align-items:center;justify-content:center><img style=width:30px;height:30px;border-radius:15px;vertical-align:text-bottom src=/profile.png alt=Home></a></li></ul></nav></div></header><div class=content><main class=main><div class=postWrapper><h1>CTFd Setup Guide</h1><div><p><strong>This guide is ported over from my original guide <a href=https://github.com/flocto/The-Range>here</a>.</strong></p><h1 id=setting-up-a-ctfd-instance>Setting up a CTFd instance</h1><p>This guide will teach you how to set up a CTFd instance using Docker and Docker Compose.</p><h2 id=pre-requisites>Pre-requisites</h2><ul><li>Basic knowledge of Docker and Docker Compose</li><li>A cloud platform that supports Docker and Docker Compose (e.g. DigitalOcean, AWS, GCP, etc.)</li><li>Knowledge of how to use a command line interface (CLI)</li><li>Ability to use <code>ssh</code> and <code>scp</code></li><li>Money (or cloud platform credits)</li></ul><hr><h1 id=step-1-set-up-a-server>Step 1: Set up a server</h1><p>The first step is to set up a server to host the actual CTFd instance. This can be done on any cloud platform that supports Docker and Docker Compose. For this guide, I will be using DigitalOcean.</p><p>If you are using a different cloud platform, the exact steps to set up a server will not be covered. However, after accessing the server through <code>ssh</code>, you can continue with the rest of the guide from <a href=#step-2-clone-the-ctfd-repository>here</a>.</p><h2 id=digitalocean-setup>DigitalOcean Setup</h2><p>If you do not already have an account with DigitalOcean, try to find a promotional registration link to get free credits. This guide does not offer any referral links, so you will have to find one on your own. GitHub Student Developer Pack members can also get $200 in credits for one year.</p><p>After you are logged in, you should be greeted with a screen that looks like this:</p><p><img src=/img/blog/2023/CTFd-setup/do_homepage.png alt="DigitalOcean Dashboard"></p><p>Navigate to the Droplet tab on the left sidebar and click on the Create button.</p><p><img src=/img/blog/2023/CTFd-setup/do_sidebar.png alt="DigitalOcean Sidebar"></p><p>You should see the Droplet creation page.</p><p><img src=/img/blog/2023/CTFd-setup/do_create_droplet.png alt="DigitalOcean Droplet Creation"></p><h3 id=droplet-settings>Droplet Settings</h3><p>For this guide, we will be using the following settings:</p><p><strong>Note: These settings may have changed by the time you read this guide, try to follow along as best as possible</strong></p><ul><li>Ubuntu 22.10 x64</li><li>Basic Plan</li><li>Regular CPU / SSD<ul><li>$6/mo (You can use a smaller plan if you want to save money)</li><li>1 GB / 1 CPU</li><li>25 GB SSD</li><li>1000 GB Transfer</li></ul></li></ul><p>Choose a datacenter region that is closest to you. This will reduce latency and improve performance. You can test latency using <a href=https://cloudpingtest.com/digital_ocean>this website</a>.</p><h3 id=ssh-keys>SSH Keys</h3><p>If you do not already have a keypair, create a new SSH key. Follow the instructions on the page, and <strong>make sure to save the private key</strong>. You will need it later.</p><p><img src=/img/blog/2023/CTFd-setup/do_sshkey.png alt="DigitalOcean SSH Key Creation"></p><p>You can enable monitoring, IPv6, and User data if you want, they are not required for this guide.</p><p>After selecting these settings, click on the Create Droplet button. You should be redirected back to your project dashboard. Click on the Droplet you just created after it is done loading.</p><p><img src=/img/blog/2023/CTFd-setup/do_projectpage.png alt="DigitalOcean project dashboard"></p><h1 id=step-2-clone-the-ctfd-repository>Step 2: Clone the CTFd repository</h1><p>At this point, you should have a cloud server that you can access. <code>ssh</code> into the server <strong>as root</strong> using the private key you saved earlier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i /path/to/private/key root@&lt;server_ip&gt;
</span></span></code></pre></div><p>You should now be in the server. Install Docker and Docker Compose using the following commands: (From the <a href=https://docs.docker.com/engine/install/ubuntu/#set-up-the-repository>official Docker documentation</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    ca-certificates <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    gnupg <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    lsb-release
</span></span><span style=display:flex><span>sudo mkdir -p /etc/apt/keyrings
</span></span><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#66d9ef>$(</span>lsb_release -cs<span style=color:#66d9ef>)</span><span style=color:#e6db74> stable&#34;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span></code></pre></div><p>We will be working in <code>/app</code> for this guide. Create the directory and change into it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /app
</span></span><span style=display:flex><span>cd /app
</span></span></code></pre></div><p>After Docker and Docker Compose are installed, clone the CTFd repository using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/CTFd/CTFd.git
</span></span><span style=display:flex><span>cd CTFd
</span></span></code></pre></div><p><img src=/img/blog/2023/CTFd-setup/server_clonectfd.png alt="Cloning the CTFd repository"></p><h1 id=step-3-configure-the-ctfd-instance>Step 3: Configure the CTFd instance</h1><p>Now that we have the CTFd repository cloned, we need to configure the CTFd instance. This can be done by editing the <code>docker-compose.yml</code> file. Open the file using your favorite text editor.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano docker-compose.yml
</span></span></code></pre></div><p>Modify the <code>SECRET_KEY</code> to a random, secret string.</p><p><img src=/img/blog/2023/CTFd-setup/ctfd_secretkey.png alt="Editing the docker-compose.yml file"></p><p>Now build the images and run the containers. This might take a while.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d --build
</span></span></code></pre></div><p><img src=/img/blog/2023/CTFd-setup/ctfd_dockerup.png alt="Building the CTFd images"></p><p>When all is said and done, you should be able to access the CTFd instance at <code>http://&lt;server_ip>:80</code>. You can also access the admin panel at <code>http://&lt;server_ip>:80/admin</code>.</p><p>To check that your CTFd instance is running, run the following command, and you should see all 4 containers running.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker ps
</span></span></code></pre></div><p><img src=/img/blog/2023/CTFd-setup/ctfd_dockerps.png alt="Checking that the CTFd containers are running"></p><p>Access your CTFd instance at <code>http://&lt;server_ip>:80</code>. You should see a setup page. Fill out the form (everything can be edited later).</p><h1 id=step-4-done>Step 4: Done!</h1><p>Now that you have a CTFd instance running, there a few things to do before fully launching the CTF.</p><ul><li>Set up SSL/TLS (Requires a domain name)<ul><li><a href=https://dev.to/roeeyn/how-to-setup-your-ctfd-platform-with-https-and-ssl-3fda>https://dev.to/roeeyn/how-to-setup-your-ctfd-platform-with-https-and-ssl-3fda</a></li></ul></li><li>Configure email</li><li>Set up challenges</li></ul><p>But for now, you have a working CTFd instance. Congratulations!</p><h1 id=step-5-bonus-setting-up-individual-challenges>Step 5: Bonus: Setting up individual challenges</h1><p>If you want a quick and lazy hack to set up small challenges on the same server as the CTFd instance, this section is for you!</p><p>Note that this is not recommended at all for any challenge that will experience major load or access during the contest. Use this <strong>ONLY</strong> for challenges you are sure will not impact
the performance of the CTFd instance in any way.</p><h2 id=step-51-create-a-new-challenge>Step 5.1: Create a new challenge</h2><p>Create any challenge either locally or on the cloud server with the CTFd instance. When you are ready, bring all the files to their own directory on the server. For this guide, we will be using the <code>/app/chal</code> directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /app/chal
</span></span><span style=display:flex><span>cd /app/chal
</span></span><span style=display:flex><span>scp -r /path/to/challenge/files root@&lt;server_ip&gt;:/app/chal
</span></span></code></pre></div><h2 id=step-52-create-a-dockerfile>Step 5.2: Create a Dockerfile</h2><p>Now create a Dockerfile and Docker Compose file for the challenge. If you aren&rsquo;t too familiar, here&rsquo;s a basic example:</p><p><strong>Dockerfile</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:20.04</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y python3 python3-pip socat<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . /app <span style=color:#75715e># contains server.py and flag.txt</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chmod <span style=color:#ae81ff>444</span> flag.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;socat&#34;</span>, <span style=color:#e6db74>&#34;-T60&#34;</span>, <span style=color:#e6db74>&#34;TCP-LISTEN:1337,reuseaddr,fork&#34;</span>, <span style=color:#e6db74>&#34;EXEC:&#39;python3 server.py&#39;,pty,stderr,echo=0&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><strong>docker-compose.yml</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;2&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>challenge</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>challenge</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;1337:1337&#34;</span>
</span></span></code></pre></div><p>You can edit these to your liking, just make sure that you don&rsquo;t impact the CTFd instance somehow.</p><h2 id=step-53-build-and-run-the-challenge>Step 5.3: Build and run the challenge</h2><p>Finally you can just run the challenge using Docker Compose.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d --build
</span></span></code></pre></div><p>Depending on what type of challenge you are running, how you access the challenge may differ. However, because of how DigitalOcean works, you don&rsquo;t need to
worry about the port or firewall, and can just directly access the challenge with <code>nc</code> or some other tool.</p><p>Finally, please remember that this is not the recommended way to set up challenges.
If you want to set up challenges properly, please refer to <a href=https://google.github.io/kctf/>kCTF and their wonderful guides</a>. Of course, kCTF does require
a bit more understanding and time to learn, but it is well worth it, especially if you are hosting a larger CTF.</p><p>Thank you for reading to the end of this guide. If you have any questions or comments, feel free to email me at <a href=mailto:flocto@duck.com>flocto@duck.com</a></p></div></div></main></div><script>function handle_open(e){e.target.classList.toggle("open"),e.target.classList.contains("open")?e.target.textContent="Click to collapse "+e.target.textContent.split(" ").slice(3).join(" "):e.target.textContent="Click to expand "+e.target.textContent.split(" ").slice(3).join(" ")}let code_divs=document.querySelectorAll("div.highlight"),to_remove=[];for(let e of code_divs){let t="",n=e.previousElementSibling;n.tagName=="P"&&(n=n.textContent,n.startsWith("filename")&&(t=n.split("=")[1].trim(),to_remove.push(e.previousElementSibling)));let s=e.querySelector("pre code"),o=s.textContent.split(`
`).length;if(t!==""||o>10){let n=document.createElement("details"),i=document.createElement("summary"),o=document.createElement("span");o.textContent="Click to expand",t!==""&&(o.textContent+=" "+t,n.setAttribute("id",t)),o.classList.add("code-summary-inner"),o.addEventListener("click",handle_open),i.appendChild(o),i.classList.add("code-summary"),s.classList.add("code-inner"),e.parentNode.insertBefore(n,e),n.appendChild(i),n.appendChild(e),n.classList.add("code-wrapper")}}for(let e of to_remove)e.remove()</script><footer class=footer>© 2023 flocto, Built with
<a href=https://gohugo.io class=footerLink>Hugo</a> and (an edited)
<a href=https://github.com/LordMathis/hugo-theme-nightfall class=footerLink>Nightfall</a> theme</footer></div></body></html>